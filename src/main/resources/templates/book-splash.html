<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <title>Bookish - Home</title>

    <link href="/styles/navbar.css" rel="stylesheet"/>
    <link href="/styles/book-splash.css" rel="stylesheet"/>
</head>
<body>
<div th:replace="fragments/navbar :: navbar">
</div>
<h3>Book page- under construction</h3>

<div class="form-check form-switch">
    <input class="form-check-input" id="flexSwitchCheckDefault" type="checkbox">
    <label class="form-check-label" for="flexSwitchCheckDefault">Admin</label>
</div>

<div class="book-splash-container">
    <div class="book-title-container">
        <h1 th:text="${bookSplashModel.getBook().getTitle()}"></h1>
        <p>
            <span class="info-field">By </span>
            <a th:href="${'/library/filterid?id='}+${bookSplashModel.getBook().getAuthorId()}+'&authorName='+${bookSplashModel.getBook().getAuthorName()}"
               th:text="${bookSplashModel.getBook().getAuthorName()}"
               type="${book.getTitle}"></a>
        </p>
    </div>
    <div class="info-qr-container">
        <div class="book-info-container">
            <table>
                <tr>
                    <td class="info-field">Published:</td>
                    <td th:text="${bookSplashModel.getBook().getPublishedDate()}"></td>
                </tr>
                <tr>
                    <td class="info-field">Publisher:</td>
                    <td th:text="${bookSplashModel.getBook().getPublisher()}"></td>
                </tr>
                <tr>
                    <td class="info-field">Genre:</td>
                    <td th:text="${bookSplashModel.getBook().getGenre()}"></td>
                </tr>
                <tr>
                    <td class="info-field">ISBN:</td>
                    <td th:text="${bookSplashModel.getBook().getIsbn()}"></td>
                </tr>
                <tr>
                    <td class="info-field">Available copies in library:</td>
                    <td th:text="${bookSplashModel.getBook().getNumberOfCopies()}"></td>
                </tr>
            </table>
        </div>

        <div class="qr-code-container">
            <img alt="qr code"
                 class="qr-code"
                 th:src="${'http://api.qrserver.com/v1/create-qr-code/?color=000000&amp;bgcolor=FFFFFF&amp;data=' + bookSplashModel.getBook().toString() + '&amp;qzone=1&amp;margin=0&amp;size=200x200&amp;ecc=L'}"/>
        </div>
    </div>

</div>

<div class="edit-book-container">
    <form id="formForEditBook" method="post" th:action="@{/book-splash/edit-book}">
        <h2>Edit book:</h2>
        <div class="form-group row" hidden>
            <label class="col-sm-2 col-form-label" form="inputId">Id</label>
            <div class="col-sm-10">
                <input class="form-control" id="inputId" name="id" th:placeholder="${bookSplashModel.getBook().getId()}"
                       th:value="${bookSplashModel.getBook().getId()}"
                       type="text">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" form="inputTitle">Title</label>
            <div class="col-sm-10">
                <input class="form-control" id="inputTitle" name="title"
                       th:placeholder="${bookSplashModel.getBook().getTitle()}"
                       th:value="${bookSplashModel.getBook().getTitle()}"
                       type="text">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" form="inputISBN">ISBN</label>
            <div class="col-sm-10">
                <input class="form-control" id="inputISBN" name="isbn"
                       th:placeholder="${bookSplashModel.getBook().getIsbn()}"
                       th:value="${bookSplashModel.getBook().getIsbn()}"
                       type="text">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" form="inputPublishedDate">Published Date</label>
            <div class="col-sm-10">
                <input class="form-control" id="inputPublishedDate" name="publishedDate"
                       th:placeholder="${bookSplashModel.getBook().getPublishedDate()}"
                       th:value="${bookSplashModel.getBook().getPublishedDate()}"
                       type="text">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" form="inputPublisher">Publisher</label>
            <div class="col-sm-10">
                <input class="form-control" id="inputPublisher" name="publisher"
                       th:placeholder="${bookSplashModel.getBook().getPublisher()}"
                       th:value="${bookSplashModel.getBook().getPublisher()}"
                       type="text">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" form="inputGenre">Genre</label>
            <div class="col-sm-10">
                <input class="form-control" id="inputGenre" name="genre"
                       th:placeholder="${bookSplashModel.getBook().getGenre()}"
                       th:value="${bookSplashModel.getBook().getGenre()}"
                       type="text">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" form="inputNumberOfCopies">Number Of Copies</label>
            <div class="col-sm-10">
                <input class="form-control" id="inputNumberOfCopies" name="numberOfCopies"
                       th:placeholder="${bookSplashModel.getBook().getNumberOfCopies()}"
                       th:value="${bookSplashModel.getBook().getNumberOfCopies()}"
                       type="text">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-sm-2 col-form-label" form="inputAuthorID">Author ID</label>
            <div class="col-sm-10 author-container">
                <input class="form-control" id="inputAuthorID" name="authorId"
                       th:placeholder="${bookSplashModel.getBook().getAuthorId()}"
                       th:value="${bookSplashModel.getBook().getAuthorId()}"
                       type="text">
                <span id="suggestedAuthorName" th:text="${bookSplashModel.getBook().getAuthorName()}"></span>
            </div>
        </div>
        <script th:inline="javascript">
            window.oninput = function () {

                document.getElementById("inputAuthorID").addEventListener('input', doThing);

                function doThing(evt) {
                    evt.preventDefault();
                    $.get({
                        url: /*[[ @{/book-splash/find-author} ]]*/ null,
                        data: {id: evt.target.value ? evt.target.value.trim() : 0}
                    }).then(function (result) {
                        $('#suggestedAuthorName').text(result);
                    });
                }
            }
        </script>
        <input type="submit" class="col-sm-12 btn btn-primary" id="editBookInput" />
    </form>
</div>
</body>
<script>
    const lastPart = window.location.href.split("?").pop();
    console.log(lastPart)

    $(document).ready(function () {

        $(".delete-button a").click(function (event) {
            if (document.getElementById('flexSwitchCheckDefault').checked) {
                console.log('checkbox is checked');
                return true;
            }
            console.log('admin right not enabled');
            event.preventDefault();
        });

        $("#flexSwitchCheckDefault").on('change', function () {
            localStorage.input = $(this).is(':checked');

            if ($(this).is(':checked')) {
                alert("Admin right enabled");
                $("#editBookInput").removeClass("disabled")
                $('#formForEditBook').show();
            } else {
                alert("Admin right disabled");
                $("#editBookInput").addClass("disabled");
                $('#formForEditBook').hide();
            }
        });
    });

    $(function () {
        const test = localStorage.input === 'true' ? true : false;
        $('#flexSwitchCheckDefault').prop('checked', test);
        console.log("Admin right: " + $("#flexSwitchCheckDefault").is(':checked'));

        if (!$("#flexSwitchCheckDefault").is(':checked')) {
            // hide content on load
            $('#formForEditBook').hide();
        }
    });
</script>

</html>