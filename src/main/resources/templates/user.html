<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <title>Bookish - Home</title>
    <link rel="stylesheet" href="/styles/navbar.css"/>
    <link href="/styles/hover-row.css" rel="stylesheet"/>

</head>
<body>
<div th:replace="fragments/navbar :: navbar">
</div>
<h3>user page- under construction</h3>

<H3>user: <span th:text="${userModel.getUser().getId()}"></span> </H3>
<h4> <span th:text="${userModel.getUser().getForename()} +' '+ ${userModel.getUser().getSurname()}" ></span> </h4>

<div id="accordion">
    <div class="card">
        <div class="card-header" id="headingOne">
            <h5 class="mb-0">
                <p>
                    <button class="btn btn-primary" onclick="change()" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" id="content-button">
                        <script>
                            function change()
                            {
                                var elem = document.getElementById("content-button");
                                if (elem.innerHTML == "Expand Content") elem.innerHTML = "Collapse Content";
                                else elem.innerHTML = "Expand Content";
                            }
                        </script>
                        Collapse Content
                    </button>
                </p>
            </h5>
        </div>

        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body">
                <h3>Current inventory: </h3>
                <div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th><a >ID</a></th>
                            <th><a >Title</a> </th>
                            <th><a >ISBN</a> </th>
                            <th><a >Published Date</a></th>
                            <th><a >Publisher</a></th>
                            <th><a >Genre</a></th>
                            <th><a >Author</a></th>
                            <th><a >Return</a></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="book : ${userModel.getBooks()}">
                            <td th:text="${book.getId()}"></td>
                            <form id="bookTitle" th:action="@{/book-splash}" method="get">
                                <input type="text" style="display: none" th:value="${book.getId}" name="filterId">
                                <td>
                                    <a th:href="${'/book-splash/filterid?id='}+${book.getId}" type="${book.getTitle}" th:text="${book.getTitle()}"></a>
                                </td>
                            </form>
                            <td th:text="${book.getIsbn()}"></td>
                            <td th:text="${book.getPublishedDate()}"></td>
                            <td th:text="${book.getPublisher()}"></td>
                            <td th:text="${book.getGenre()}"></td>
                            <td th:text="${book.getAuthorName()}"></td>
                            <td> <a th:href="${'/user/userid?id='} + ${userModel.getUser().getId()} + '&forename=' + ${userModel.getUser().getForename} + '&surname=' + ${userModel.getUser().getSurname} +
                            '&bookID=' + ${book.getId} + '&return=true'" class="btn btn-primary">Return</a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header" id="headingTwo">
            <h5 class="mb-0">
                <p>
                    <button class="btn btn-primary" onclick="change2()" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" id="content-button2">
                        <script>
                            function change2()
                            {
                                var elem = document.getElementById("content-button2");
                                if (elem.innerHTML == "Expand Content") elem.innerHTML = "Collapse Content";
                                else elem.innerHTML = "Expand Content";
                            }
                        </script>
                        Collapse Content
                    </button>
                </p>
            </h5>
        </div>

        <div id="collapseTwo" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body">
                <h3> Available book borrow: </h3>
                <div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th><a >ID</a></th>
                            <th><a >Title</a> </th>
                            <th><a >ISBN</a> </th>
                            <th><a >Published Date</a></th>
                            <th><a >Publisher</a></th>
                            <th><a >Genre</a></th>
                            <th><a >Number of Copies</a></th>
                            <th><a >Author</a></th>
                            <th><a >Borrow</a></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="book : ${userModel.getAvailableBooksToBorrow()}" th:attr="data-href=${'/book-splash/filterid?id='}+${book.getId}">
                            <td th:text="${book.getId()}"></td>

                                <td th:text="${book.getTitle()}">
                                </td>
                            <td th:text="${book.getIsbn()}"></td>
                            <td th:text="${book.getPublishedDate()}"></td>
                            <td th:text="${book.getPublisher()}"></td>
                            <td th:text="${book.getGenre()}"></td>
                            <td th:text="${book.getNumberOfCopies()}"></td>
                            <td th:href="${'/library/filterid?id='}+${book.getAuthorId}+${'&authorName='}+${book.getAuthorName}" th:text="${book.getAuthorName()}"></td>
                            <td> <a th:href="${'/user/userid?id='} + ${userModel.getUser().getId()} + '&forename=' + ${userModel.getUser().getForename} + '&surname=' + ${userModel.getUser().getSurname} +
                            '&bookID=' + ${book.getId}" class="btn btn-primary"> Borrow </a> </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const rows = document.querySelectorAll("tr[data-href]")
        rows.forEach(row => {
            row.addEventListener("click", () => {
                window.location.href = row.dataset.href;
            })
        })
    })
</script>
</html>